<!-- templates/browse.html -->
{% extends "base.html" %}

{% block title %}Browse {{ path }}{% endblock %}

{% block content %}
<h2>Path: {{ path }}</h2>

<!-- Хлебные крошки -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        {% for crumb in breadcrumbs %}
        {% if not loop.last %}
        <li class="breadcrumb-item">
            <a href="{{ url_for('browse', file_path=crumb.path) }}">{{ crumb.name }}</a>
        </li>
        {% else %}
        <li class="breadcrumb-item active" aria-current="page">{{ crumb.name }}</li>
        {% endif %}
        {% endfor %}
    </ol>
</nav>

<!-- Кнопка возврата к родительской папке -->
{% if parent_dir %}
<a href="{{ url_for('browse', file_path=parent_dir) }}" class="btn btn-primary mb-3">Go Up</a><br>
{% endif %}

<!-- Список папок -->
<h3>Folders:</h3>
<ul class="list-unstyled">
    {% if folders %}
    {% for folder in folders %}
    <li class="folder d-flex align-items-center mb-2">
        <i class="fas fa-folder text-warning mr-2"></i>
        <a href="{{ url_for('browse', file_path=join(path, folder)) }}" class="text-decoration-none">{{ folder }}</a>
    </li>
    {% endfor %}
    {% else %}
    <li class="text-muted">No folders found.</li>
    {% endif %}
</ul>

<!-- Список файлов -->
<h3>Files:</h3>
<ul class="list-unstyled">
    {% if files %}
    <!-- Форма для Add to Playlist -->
    <form id="playlistForm" action="{{ url_for('browse', file_path=path) }}" method="post">
        <input type="hidden" name="action" value="add_selected">
        <ul>
            {% for file in files %}
            <li class="file d-flex align-items-center mb-2">
                <i class="fas fa-file-audio text-primary mr-2"></i>
                <input type="checkbox" name="files" value="{{ file }}" class="mr-2">
                <label>{{ file }}</label>
            </li>
            {% endfor %}
        </ul>
    </form>

    <!-- Модальное окно для создания плейлиста -->
    <div class="modal fade" id="playlistModal" tabindex="-1" role="dialog" aria-labelledby="playlistModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="playlistModalLabel">Create Playlist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Select files to add to the playlist:</p>
                    <form id="modalPlaylistForm" action="{{ url_for('browse', file_path=path) }}" method="post">
                        <input type="hidden" name="action" value="add_selected">
                        <ul>
                            {% for file in files %}
                            <li>
                                <input type="checkbox" name="files" value="{{ file }}"> {{ file }}
                            </li>
                            {% endfor %}
                        </ul>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="modalPlaylistForm" class="btn btn-primary">Create Playlist</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Кнопки для создания плейлиста -->
    <div class="btn-group mt-3">
        <!-- Кнопка для вызова модального окна -->
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#playlistModal">
            Add to Playlist
        </button>

        <!-- Кнопка Add all to Playlist -->
        <form action="{{ url_for('browse', file_path=path) }}" method="post" class="d-inline">
            <input type="hidden" name="action" value="add_all">
            <button type="submit" class="btn btn-info ml-2">Add all to Playlist</button>
        </form>
    </div>
    {% else %}
    <li class="text-muted">No files found.</li>
    {% endif %}
</ul>
{% endblock %}